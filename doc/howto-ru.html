<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>DDNS Dokumentation</title>


<link type="text/css" rel="stylesheet" href="http://isp-control.net/wp-2012ispcp/themes/InnovationScience2/style.css" />              
        <link type="text/css" rel="stylesheet" href="http://isp-control.net/wp-2012ispcp/themes/InnovationScience2/css/superfish.css" /> 
        <link type="text/css" rel="stylesheet" href="http://isp-control.net/wp-2012ispcp/themes/InnovationScience2/css/pphoto/prettyPhoto.css" />  
        <link type="text/css" rel="stylesheet" href="http://isp-control.net/wp-2012ispcp/themes/InnovationScience2/css/dc-tips.css" />     
        <link type="text/css" rel="stylesheet" href="http://isp-control.net/wp-2012ispcp/themes/InnovationScience2/css/common.css" />                       
        <link href="http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:light" rel="stylesheet" type="text/css">
        <link rel='stylesheet' id='NextGEN-css'  href='http://isp-control.net/wp-2012ispcp/plugins/nextgen-gallery/css/nggallery.css' type='text/css' media='screen' />
<link rel='stylesheet' id='dcpNewsletter_common_css-css'  href='http://isp-control.net/wp-2012ispcp/plugins/dcp-newsletter/css/common.css' type='text/css' media='all' />
<link type="text/css" rel="stylesheet" href="http://www.isp-control.net/forum/cache/themes/theme2/star_ratings.css" />
<link type="text/css" rel="stylesheet" href="http://www.isp-control.net/forum/cache/themes/theme2/showthread.css" />

  </head>
  <body>



<div id="pid_88432" class="post_body">
				<span style="font-weight: bold;">Свой динамический ДНС сервис /</span><span style="font-weight: bold;"> Dynamic DNS Service</span><br>
<span style="font-weight: bold;">чтоб все работало нужно выполнить следующие требования:</span><br>
  - Один Debian-Server с ISPCP, FQHN <span style="font-style: italic;">myhost.server.tld</span>, bind9 и dnsutils (если вы устанавливали сервер по документации испцп, то все отлично).<br>
  - Два IP адреса из разных сеток <span style="font-style: italic;">123.123.<span style="font-weight: bold;">111</span>.10</span> и <span style="font-style: italic;">123.123.<span style="font-weight: bold;">222</span>.10</span>, которые уже настроены в <span style="font-style: italic;">/etc/network/interfaces</span>.<br>
  - Оба IP адреса должны быть зарегистрированы как Nameserver. Регистрация ДНС серверов происходит по разному, это зависит от вашего регистратора доменов. Для этого требуются следующие данные:<br>
  <span style="font-style: italic;">123.123.<span style="font-weight: bold;">111</span>.10 ns1.ddns.tld</span> <br>
  <span style="font-style: italic;">123.123.<span style="font-weight: bold;">222</span>.10 ns2.ddns.tld</span><br>
  - Ну и конечно нам нужен домен, который мы будем обновлять динамически <span style="font-style: italic;">ddns.tld</span>.<br>
<span style="font-weight: bold;">1.</span> в панели регистратора поставим IN NS записи на <span style="font-style: italic;">ns1.ddns.tld</span> и <span style="font-style: italic;">ns2.ddns.tld </span>(это будет работать только после регистрации этих имен с нашими IP aдресами)<br>
<span style="font-weight: bold;">1.1</span> на нашем сервере создадим пару файлов, <span style="font-style: italic;">nsupdate.key</span> будет содержать TSIG ключ, который позволяет зашифровано и безопасно обновлять домен.<br>
  Во втором файле,<span style="font-style: italic;"> nsupdate.conf</span>, будет днс зона для динамического домена <span style="font-style: italic;">ddns.tld.</span> и так...<br>
  <span style="font-style: italic;">touch /etc/bind/nsupdate.key</span><br>
  <span style="font-style: italic;">touch /etc/bind/nsupdate.conf</span><br>
  <span style="font-style: italic;">chown bind:bind /etc/bind/nsupdate.*</span><br>
  <span style="font-style: italic;">chmod 644 /etc/bind/nsupdate.*</span><br>
<span style="font-weight: bold;">1.2</span> надо инклудировать эти новые файлы в главную конфигурацию Bind9. Открываем нашим любимым эдитором (я люблю vi, пользуйте что вам по душе)<br>
  <span style="font-style: italic;">vi /etc/bind/named.conf</span><br>
  и в самом начале добавляем две строки:<br>
  <span style="font-style: italic;">include "/etc/bind/nsupdate.key";</span><br>
  <span style="font-style: italic;">include "/etc/bind/nsupdate.conf";</span><br>
  Внимание, что-бы панель не попортила наши изменения, надо прописать их и сюда<br>
  <span style="font-style: italic;">vi /etc/ispcp/bind/working/named.conf</span><br>
  и добавить опять-же те две строки, в самом верху:<br>
  <span style="font-style: italic;">include "/etc/bind/nsupdate.key";</span><br>
  <span style="font-style: italic;">include "/etc/bind/nsupdate.conf";</span><br>
<span style="font-weight: bold;">1.3</span> Открываем конфигурационный файл<br>
  <span style="font-style: italic;">vi /etc/bind/nsupdate.conf</span><br>
  и добавляем новую днс зону<br>
  <div class="codeblock phpcodeblock"><div class="title">PHP Code:<br>
</div><div class="body"><div dir="ltr"><code><span style="color: #FF8000">//&nbsp;dmn&nbsp;[ddns.tld]&nbsp;cfg&nbsp;entry&nbsp;BEGIN.[/i]<br>&nbsp;&nbsp;</span><span style="color: #0000BB">zone&nbsp;</span><span style="color: #DD0000">"ddns.tld"&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;master</span><span style="color: #007700">;<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"/var/cache/bind/ddns.tld.db"</span><span style="color: #007700">;<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notify&nbsp;&nbsp;YES</span><span style="color: #007700">;<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow</span><span style="color: #007700">-</span><span style="color: #0000BB">update&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key&nbsp;ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">;<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">};<br>&nbsp;&nbsp;};<br>&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;dmn&nbsp;[ddns.tld]&nbsp;cfg&nbsp;entry&nbsp;END.&nbsp;<br></span></code></div></div></div>
  Обратите внимание на <span style="font-style: italic;">allow-update</span>, <span style="font-style: italic;">key ddns.tld</span> это название ключа для безопасных обновлений. Это название пригодиться позже еще.<br>
<span style="font-weight: bold;">1.4</span> создаем Cache-файл для Bind в котором он будет сохранять обновления зоны<br>
  <span style="font-style: italic;">touch /var/cache/bind/ddns.tld.db</span><br>
  <span style="font-style: italic;">chown bind:bind /var/cache/bind/ddns.tld.db</span><br>
  <span style="font-style: italic;">chmod 644 /var/cache/bind/ddns.tld.db</span><br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
  <span style="font-weight: bold;">1.5</span> в Cache-файл <br>
  <span style="font-style: italic;">vi /var/cache/bind/ddns.tld.db</span><br>
  добавим изначальную конфигурацию <br>
  <div class="codeblock phpcodeblock"><div class="title">PHP Code:<br>
</div><div class="body"><div dir="ltr"><code><span style="color: #0000BB">$ORIGIN&nbsp;</span><span style="color: #007700">.<br>&nbsp;&nbsp;</span><span style="color: #0000BB">$TTL&nbsp;60&nbsp;</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">1&nbsp;minute<br>&nbsp;&nbsp;ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;SOA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ns1</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">postmaster</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.&nbsp;(<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2007072555&nbsp;</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">serial<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">refresh&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">2&nbsp;hours</span><span style="color: #007700">)<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;900&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">retry&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">15&nbsp;minutes</span><span style="color: #007700">)<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1857600&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">expire&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">3&nbsp;weeks&nbsp;12&nbsp;hours</span><span style="color: #007700">)<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8400&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">minimum&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">2&nbsp;hours&nbsp;20&nbsp;minutes</span><span style="color: #007700">)<br>&nbsp;&nbsp;)<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ns1</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ns2</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;123.123.1.10<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;mail</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"v=spf1&nbsp;a&nbsp;mx&nbsp;ip4:123.123.111.10&nbsp;ip4:123.123.111.10&nbsp;~all"<br>&nbsp;&nbsp;</span><span style="color: #0000BB">$ORIGIN&nbsp;ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.<br>&nbsp;&nbsp;</span><span style="color: #0000BB">www&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;123.123.1.10&nbsp;</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">www</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld<br>&nbsp;&nbsp;</span><span style="color: #007700">*</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;www&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">;&nbsp;*.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld&nbsp;wildcard<br>&nbsp;&nbsp;mail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;123.123.1.10&nbsp;</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">mail</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld&nbsp;</span><span style="color: #007700">for&nbsp;</span><span style="color: #0000BB">MX&nbsp;record<br>&nbsp;&nbsp;ns1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;123.123.111.10&nbsp;</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">glue&nbsp;record</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">first&nbsp;ip<br>&nbsp;&nbsp;ns2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;123.123.222.10&nbsp;</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">glue&nbsp;record</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">second&nbsp;ip&nbsp;<br></span></code></div></div></div>
  как видите в нашей зоне опять IN NS-записи которые приводят в замкнутый круг, но... в этот раз мы прописали под-домены <span style="font-style: italic;">ns1</span> и <span style="font-style: italic;">ns2 </span>с записями <span style="font-style: italic;">IN A</span> к нашим IP-адресам. Это так называемые <span style="font-style: italic;">glue record</span>, они нам позволяют использовать днс сервера на его-же под-доменах, без проблемы что запросы будут бегать по кругу.<br>
<span style="font-weight: bold;">2.</span> Вот тут нам потребуется выше названый ключ для шифрования обновлений, чтоб его создать воспользуемся генератором из пакета dnsutils<br>
  <span style="font-style: italic;">cd /etc/bind</span><br>
  <span style="font-style: italic;">dnssec-keygen -a HMAC-MD5 -b 512 -n HOST ddns.tld</span><br>
  генератор создаст нам два файла, <span style="font-style: italic;">K&lt;keyname&gt;+157+&lt;keyid&gt;.key</span> и <span style="font-style: italic;">K&lt;keyname&gt;+157+&lt;keyid&gt;.private</span>. <span style="font-style: italic;">&lt;keyname&gt;</span> является названием ключа, которое, если я не ошибаюсь, мы прописали в <span style="font-style: italic;">/etc/bind/nsupdate.conf</span>. Это не совпадение, параметр генератора <span style="font-style: italic;">-n HOST &lt;keyname&gt; </span>наколдовал. <span style="font-style: italic;">&lt;keyid&gt;</span> просто число сгенерированое случайным методом, чтоб избежать повторность. В нашем примере мы получим два файла примерно с таким названием <span style="font-style: italic;">Kddns.tld.+157+41090.key</span> и <span style="font-style: italic;">Kddns.tld.+157+41090.private</span>,<br>
  откроем эдитором <span style="font-style: italic;">Kddns.tld.+157+41090.private</span> и скопируем длинный ключ, который примерно так выглядит:<br>
  <span style="font-style: italic;">Y1xlce0Ub0ePfxslRVbfYUh/berC9R32XmFaen3VScpHw9fX79ZNo9ESGUhH5qtVXoTyyvdouP7t1TIgm62Whg==</span><br>
<span style="font-weight: bold;">2.1</span> Засунем его в <span style="font-style: italic;">/etc/bind/nsupdate.key </span>под секцией<span style="font-style: italic;"> secret</span>, добавим все это вот так:<br>
  <div class="codeblock phpcodeblock"><div class="title">PHP Code:<br>
</div><div class="body"><div dir="ltr"><code><span style="color: #0000BB">key&nbsp;ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;algorithm&nbsp;hmac</span><span style="color: #007700">-</span><span style="color: #0000BB">md5</span><span style="color: #007700">;<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;secret&nbsp;</span><span style="color: #DD0000">"Y1xlce0Ub0ePfxslRVbfYUh/berC9R32XmFaen3VScpHw9fX79ZNo9ESGUhH5qtVXoTyyvdouP7t1TIgm62Whg=="</span><span style="color: #007700">;<br>&nbsp;&nbsp;};&nbsp;<br></span></code></div></div></div>
  И опять то-же самое название <span style="font-style: italic;">key ddns.tld</span>, что в конфигурации зоны под <span style="font-style: italic;">allow-update</span> и при создании ключа.<br>
<span style="font-weight: bold;">2.2</span> Перезагрузим Bind<br>
  <span style="font-style: italic;">/etc/init.d/bind9 restart</span><br>
  почти все, динамические обновления зоны уже работают! С помощью <span style="font-style: italic;">nsupdate</span> мы можем добавлять и удалять записи в зоне <span style="font-style: italic;">ddns.tld</span>!<br>
<span style="font-weight: bold;">3.</span> Так как у нас есть рабочая динамическая зона, мы хотим и удобный для управления Web-UI и возможность обновлять через HTTP.<br>
<span style="font-weight: bold;">3.1 </span>Скачиваем DDNS Update Utility и распаковываем<br>
  <span style="font-style: italic;">cd /var/www/ispcp/gui/tools/</span><br>
  <span style="font-style: italic;">wget <a href="http://citex.net/ddns.tar.gz" target="_blank">http://citex.net/ddns.tar.gz</a></span><br>
  <span style="font-style: italic;">tar xfvz ddns.tar.gz</span><br>
  <span style="font-style: italic;">mv ddns-0.3 ddns</span><br>
<span style="font-weight: bold;">3.2</span> В <span style="font-style: italic;">/etc/apache2/sites-enabled/00_master.conf</span> и <span style="font-style: italic;">/etc/ispcp/apache/00_master.conf</span><br>
  добаим алиас, в главный VirtualHost<br>
  <span style="font-style: italic;">Alias /ddns&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /var/www/ispcp/gui/tools/ddns/</span><br>
  Результат примерно такой:<br>
  <div class="codeblock phpcodeblock"><div class="title">PHP Code:<br>
</div><div class="body"><div dir="ltr"><code><span style="color: #0000BB">Alias&nbsp;</span><span style="color: #007700">/</span><span style="color: #0000BB">pma&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">/var/</span><span style="color: #0000BB">www</span><span style="color: #007700">/</span><span style="color: #0000BB">ispcp</span><span style="color: #007700">/</span><span style="color: #0000BB">gui</span><span style="color: #007700">/</span><span style="color: #0000BB">tools</span><span style="color: #007700">/</span><span style="color: #0000BB">pma</span><span style="color: #007700">/<br>&nbsp;&nbsp;</span><span style="color: #0000BB">Alias&nbsp;</span><span style="color: #007700">/</span><span style="color: #0000BB">webmail&nbsp;&nbsp;</span><span style="color: #007700">/var/</span><span style="color: #0000BB">www</span><span style="color: #007700">/</span><span style="color: #0000BB">ispcp</span><span style="color: #007700">/</span><span style="color: #0000BB">gui</span><span style="color: #007700">/</span><span style="color: #0000BB">tools</span><span style="color: #007700">/</span><span style="color: #0000BB">webmail</span><span style="color: #007700">/<br>&nbsp;&nbsp;</span><span style="color: #0000BB">Alias&nbsp;</span><span style="color: #007700">/</span><span style="color: #0000BB">ftp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">/var/</span><span style="color: #0000BB">www</span><span style="color: #007700">/</span><span style="color: #0000BB">ispcp</span><span style="color: #007700">/</span><span style="color: #0000BB">gui</span><span style="color: #007700">/</span><span style="color: #0000BB">tools</span><span style="color: #007700">/</span><span style="color: #0000BB">filemanager</span><span style="color: #007700">/<br>&nbsp;&nbsp;</span><span style="color: #0000BB">Alias&nbsp;</span><span style="color: #007700">/</span><span style="color: #0000BB">mail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">/var/</span><span style="color: #0000BB">www</span><span style="color: #007700">/</span><span style="color: #0000BB">ispcp</span><span style="color: #007700">/</span><span style="color: #0000BB">gui</span><span style="color: #007700">/</span><span style="color: #0000BB">tools</span><span style="color: #007700">/</span><span style="color: #0000BB">roundcube</span><span style="color: #007700">/<br>&nbsp;&nbsp;</span><span style="color: #0000BB">Alias&nbsp;</span><span style="color: #007700">/</span><span style="color: #0000BB">ddns&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">/var/</span><span style="color: #0000BB">www</span><span style="color: #007700">/</span><span style="color: #0000BB">ispcp</span><span style="color: #007700">/</span><span style="color: #0000BB">gui</span><span style="color: #007700">/</span><span style="color: #0000BB">tools</span><span style="color: #007700">/</span><span style="color: #0000BB">ddns</span><span style="color: #007700">/&nbsp;<br></span></code></div></div></div>
  apache веб-сервер мы перезагрузим чють позже, т.к. еще будем делать изменения которые требуют его перезагрузку.<br>
<span style="font-weight: bold;">3.3</span> Скрипту требуется один из файлов, что мы генерировали раньше, тот что с суффиксом <span style="font-style: italic;">.key</span>, скопируем его<br>
  <span style="font-style: italic;">cp /etc/bind/Kddns.tld.+157+41090.key /var/www/ispcp/gui/tools/ddns/keys/Kddns.tld.+157+41090.key</span><br>
<span style="font-weight: bold;">3.4</span> Укажем его в конфигурации скрипта<br>
  <span style="font-style: italic;">vi /var/www/ispcp/gui/tools/ddns/inc/config.php</span><br>
  подскажем изменяемой <span style="font-style: italic;">$conf['nskey'] </span>название файла<br>
  <span style="font-style: italic;">$conf['nskey'] = "keys/Kddns.tld.+157+41090.key";</span><br>
  кроме того укажем имя и пароль администратора<br>
  <span style="font-style: italic;">$conf['adminuser'] = "admin";</span><br>
  <span style="font-style: italic;">$conf['adminpass'] = "pass123";</span><br>
  и домен который мы хотим обновлять по умолчанию (в случае если мы создали в шагах <span style="font-weight: bold;">1, 1.3, 1.4</span> и <span style="font-weight: bold;">1.5</span> больше чем одну динамическую зону)<br>
  <span style="font-style: italic;">$conf['domain'] = 'ddns.tld';</span><br>
<span style="font-weight: bold;">3.5</span> для аутентификации пользователей требуется база данных MySQL, создадим ее и назовем <span style="font-style: italic;">ddns</span>, в нее добавим следующие таблички:<br>
  <div class="codeblock phpcodeblock"><div class="title">PHP Code:<br>
</div><div class="body"><div dir="ltr"><code><span style="color: #0000BB">CREATE&nbsp;TABLE&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">accounts</span><span style="color: #007700">`&nbsp;(<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">A_id</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">11</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">NOT&nbsp;NULL&nbsp;auto_increment</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">user</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">varchar</span><span style="color: #007700">(</span><span style="color: #0000BB">20</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">collate&nbsp;utf8_unicode_ci&nbsp;NOT&nbsp;NULL</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">password</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">varchar</span><span style="color: #007700">(</span><span style="color: #0000BB">20</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">collate&nbsp;utf8_unicode_ci&nbsp;NOT&nbsp;NULL</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">dmnid</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">11</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">NOT&nbsp;NULL</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">approved</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">11</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">NOT&nbsp;NULL&nbsp;</span><span style="color: #007700">default&nbsp;</span><span style="color: #DD0000">'0'</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">email</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">varchar</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">collate&nbsp;utf8_unicode_ci&nbsp;NOT&nbsp;NULL</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">registered</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">NOT&nbsp;NULL</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">lastupdate</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">NOT&nbsp;NULL</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">ip</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">varchar</span><span style="color: #007700">(</span><span style="color: #0000BB">50</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">collate&nbsp;utf8_unicode_ci&nbsp;NOT&nbsp;NULL</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;PRIMARY&nbsp;KEY&nbsp;&nbsp;</span><span style="color: #007700">(`</span><span style="color: #DD0000">A_id</span><span style="color: #007700">`)<br>&nbsp;&nbsp;)&nbsp;</span><span style="color: #0000BB">ENGINE</span><span style="color: #007700">=</span><span style="color: #0000BB">MyISAM&nbsp;&nbsp;</span><span style="color: #007700">DEFAULT&nbsp;</span><span style="color: #0000BB">CHARSET</span><span style="color: #007700">=</span><span style="color: #0000BB">utf8&nbsp;COLLATE</span><span style="color: #007700">=</span><span style="color: #0000BB">utf8_unicode_ci&nbsp;AUTO_INCREMENT</span><span style="color: #007700">=</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">;&nbsp;<br></span></code></div></div></div>
<div class="codeblock phpcodeblock"><div class="title">PHP Code:<br>
</div><div class="body"><div dir="ltr"><code><span style="color: #0000BB">CREATE&nbsp;TABLE&nbsp;</span><span style="color: #007700">IF&nbsp;</span><span style="color: #0000BB">NOT&nbsp;EXISTS&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">domains</span><span style="color: #007700">`&nbsp;(<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">D_id</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">11</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">NOT&nbsp;NULL&nbsp;auto_increment</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">domain</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">varchar</span><span style="color: #007700">(</span><span style="color: #0000BB">50</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">collate&nbsp;utf8_unicode_ci&nbsp;NOT&nbsp;NULL</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;PRIMARY&nbsp;KEY&nbsp;&nbsp;</span><span style="color: #007700">(`</span><span style="color: #DD0000">D_id</span><span style="color: #007700">`),<br>&nbsp;&nbsp;</span><span style="color: #0000BB">&nbsp;&nbsp;UNIQUE&nbsp;KEY&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">domain</span><span style="color: #007700">`&nbsp;(`</span><span style="color: #DD0000">domain</span><span style="color: #007700">`)<br>&nbsp;&nbsp;)&nbsp;</span><span style="color: #0000BB">ENGINE</span><span style="color: #007700">=</span><span style="color: #0000BB">MyISAM&nbsp;&nbsp;</span><span style="color: #007700">DEFAULT&nbsp;</span><span style="color: #0000BB">CHARSET</span><span style="color: #007700">=</span><span style="color: #0000BB">utf8&nbsp;COLLATE</span><span style="color: #007700">=</span><span style="color: #0000BB">utf8_unicode_ci&nbsp;AUTO_INCREMENT</span><span style="color: #007700">=</span><span style="color: #0000BB">3&nbsp;</span><span style="color: #007700">;&nbsp;<br></span></code></div></div></div>
<span style="font-weight: bold;">3.6</span> чтоб протестировать, закинем пару учетных записей:<br>
  <div class="codeblock phpcodeblock"><div class="title">PHP Code:<br>
</div><div class="body"><div dir="ltr"><code><span style="color: #0000BB">INSERT&nbsp;INTO&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">accounts</span><span style="color: #007700">`&nbsp;(`</span><span style="color: #DD0000">A_id</span><span style="color: #007700">`,&nbsp;`</span><span style="color: #DD0000">user</span><span style="color: #007700">`,&nbsp;`</span><span style="color: #DD0000">password</span><span style="color: #007700">`,&nbsp;`</span><span style="color: #DD0000">dmnid</span><span style="color: #007700">`,&nbsp;`</span><span style="color: #DD0000">approved</span><span style="color: #007700">`,&nbsp;`</span><span style="color: #DD0000">email</span><span style="color: #007700">`,&nbsp;`</span><span style="color: #DD0000">registered</span><span style="color: #007700">`,&nbsp;`</span><span style="color: #DD0000">lastupdate</span><span style="color: #007700">`,&nbsp;`</span><span style="color: #DD0000">ip</span><span style="color: #007700">`)&nbsp;</span><span style="color: #0000BB">VALUES<br>&nbsp;&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'myhomepc'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'pass123'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'home@mail.tld'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1285356317</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1285356317</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">),<br>&nbsp;&nbsp;(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'myworkpc'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'pass123'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'work@mail.tld'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1285356317</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1285356317</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">);&nbsp;<br></span></code></div></div></div>
  поля registered и lastupdate являются unix timestamp, добавляя записи вручную укажем что угодно, скрип опять-же заполняет эти поля настоящим временем регистрации и обновления.<br>
<div class="codeblock phpcodeblock"><div class="title">PHP Code:<br>
</div><div class="body"><div dir="ltr"><code><span style="color: #0000BB">INSERT&nbsp;INTO&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">domains</span><span style="color: #007700">`&nbsp;(`</span><span style="color: #DD0000">D_id</span><span style="color: #007700">`,&nbsp;`</span><span style="color: #DD0000">domain</span><span style="color: #007700">`)&nbsp;</span><span style="color: #0000BB">VALUES<br>&nbsp;&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'ddns.tld'</span><span style="color: #007700">),<br>&nbsp;&nbsp;(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'ddnsx.tld'</span><span style="color: #007700">),<br>&nbsp;&nbsp;(</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'ddnsy.tld'</span><span style="color: #007700">);&nbsp;<br></span></code></div></div></div>
  тут мы можем указать все домены, которым мы создали в шагах <span style="font-weight: bold;">1, 1.3, 1.4</span> и <span style="font-weight: bold;">1.5</span> динамические зоны.<br>
<span style="font-weight: bold;">3.7</span> в <span style="font-style: italic;">/var/www/ispcp/gui/tools/ddns/inc/db.php</span> нужно теперь указать доступ к базе данных MySQL<br>
  <span style="font-style: italic;"># Database connection.</span><br>
  <span style="font-style: italic;">$db_host = "localhost";</span><br>
  <span style="font-style: italic;">$db_user = "dbuser";</span><br>
  <span style="font-style: italic;">$db_pass = "dbpass";</span><br>
  <span style="font-style: italic;">$db_database = "ddns";</span><br>
  лично я создал нового MySQL юзера для скрипта и дал ему права только на базу данных <span style="font-style: italic;">ddns</span>, чтоб не рисковать <span style="font-style: italic;">root</span>-юзером.<br>
<span style="font-weight: bold;">3.8</span> Что-бы скрипт мог выполнять команду <span style="font-style: italic;">nsupdate</span>, требуется разрешить PhP пользовать функцыю <span style="font-style: italic;">system()</span>. Это мы позволим только главному VirtualHost-у,<br>
  на котором работает панель, что-бы нашы клиенты не могли воспользоваться этой дыркой в безопасности сервера.<br>
  <span style="font-style: italic;">vi /var/www/fcgi/master/php5/php.ini</span><br>
  удалим <span style="font-style: italic;">system</span> из строки <span style="font-style: italic;">disable_functions</span>:<br>
  <span style="font-style: italic;">disable_functions = show_source, system, shell_exec, passthru, exec, phpinfo, shell, symlink</span><br>
  результат такой:<br>
  <span style="font-style: italic;">disable_functions = show_source, shell_exec, passthru, exec, phpinfo, shell, symlink</span><br>
  теперь перезагрузим апач <span style="font-style: italic;">/etc/init.d/apache2 restart</span> т.к. больше изменений в его конфигурации, и в конфигурации к нему подключеных модуелей больше не будет.<br>
<span style="font-weight: bold;">3.9</span> Наконец, хосты <span style="font-style: italic;">myhomepc.ddns.tld</span> и <span style="font-style: italic;">myworkpc.ddns.tld</span> мы можем цеплять на наш домашний или любой другой IP адрес. Обновления вступают в силу в течении нескольких минут, восновном даже секунд!<br>
Что-бы добавить больше хостов, повторите шаг <span style="font-weight: bold;">3.6</span>, тоесть добавьте запись в базу данных. Или в DDNS Update Utility кликните на Register, там все само объяснится.<br>
Для обновления вручную идем по адресу <span style="font-style: italic;">http://myhost.server.tld/ddns</span> и кликнем на Update<br>
Для обновленя в рутерах, скриптах и других автоматизациях, используем HTTP URL:<br>
  <span style="font-style: italic;">http://myhost.server.tld/ddns/ddns.php?user=&lt;username&gt;&amp;pass=&lt;password&gt;</span><br>
  Если вы создали несколько динамических зон, то пользователь должен указать домен, на котором он заегистрировал свой хост, для чего требуется подвесить параметр <span style="font-style: italic;">domain</span> к URL:<br>
  <span style="font-style: italic;">http://myhost.server.tld/ddns/ddns.php?user=&lt;username&gt;&amp;pass=&lt;password&gt;&amp;domain=&lt;domain&gt;</span><br>
  IP адрес хоста восновном распознается автоматически, если это по какой-то причине не срабатывает или не требуется, то можно указать его вручную и подцепить к URL:<br>
  <span style="font-style: italic;">http://myhost.server.tld/ddns/ddns.php?user=&lt;username&gt;&amp;pass=&lt;password&gt;&amp;ip=&lt;ipaddress&gt;</span><br>
  вот так можно указать оба параметра:<br>
  <span style="font-style: italic;">http://myhost.server.tld/ddns/ddns.php?user=&lt;username&gt;&amp;pass=&lt;password&gt;&amp;domain=&lt;domain&gt;&amp;ip=&lt;ipaddress&gt;</span><br>
<span style="font-weight: bold;">Дополнительная информация</span><br>
<span style="font-weight: bold;">Несколько нужных команд для Bind</span><br>
  Что-бы делат ручные изменения в динаической зоне ее надо "заморозить". Внимание, замороженя зона не принимает обновления от <span style="font-style: italic;">nsupdate</span>. <span style="font-style: italic;">freeze</span> сохранит все динамические изменения в кэше зоны и поставит ее в статус <span style="font-style: italic;">static zone</span>: <br>
  <span style="font-style: italic;">rndc freeze ddns.tld</span><br>
  после ручных изменений требуется перезагрузить зону, что-бы Bind их принял. <span style="font-style: italic;">reload</span> работает только со <span style="font-style: italic;">static zone</span> и замороеными динамическими: <br>
  <span style="font-style: italic;">rndc reload ddns.tld</span><br>
  после чего надо зону опять "оттаить". <span style="font-style: italic;">thaw</span> поменяет статус oбратно в <span style="font-style: italic;">dynamic zone</span>. В этом статусе зона не принемает ручных изменений, но принимает опять <span style="font-style: italic;">nsupdate</span>:<br>
  <span style="font-style: italic;">rndc thaw ddns.tld</span><br>
<span style="font-weight: bold;">Функциональность зоны</span><br>
  Скипт обновляет не только <span style="font-style: italic;">IN A</span> запись хоста, еще он создает <span style="font-style: italic;">IN MX</span> запись и <span style="font-style: italic;">wildcard на все под-домены хоста</span>:<br>
  <div class="codeblock phpcodeblock"><div class="title">PHP Code:<br>
</div><div class="body"><div dir="ltr"><code><span style="color: #0000BB">host</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dyn</span><span style="color: #007700">-</span><span style="color: #0000BB">ip</span><span style="color: #007700">-</span><span style="color: #0000BB">address<br>&nbsp;&nbsp;mail</span><span style="color: #007700">.</span><span style="color: #0000BB">host</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dyn</span><span style="color: #007700">-</span><span style="color: #0000BB">ip</span><span style="color: #007700">-</span><span style="color: #0000BB">address<br>&nbsp;&nbsp;</span><span style="color: #007700">*.</span><span style="color: #0000BB">host</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;CNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.<br>&nbsp;&nbsp;</span><span style="color: #0000BB">host</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.</span><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;MX&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mail</span><span style="color: #007700">.</span><span style="color: #0000BB">host</span><span style="color: #007700">.</span><span style="color: #0000BB">ddns</span><span style="color: #007700">.</span><span style="color: #0000BB">tld</span><span style="color: #007700">.&nbsp;<br></span></code></div></div></div>
серезная альтернатива к dyndns.org, темболее у них только два динамических хоста безплатно <img src="images/smilies/wink.gif" style="vertical-align: middle;" border="0" alt="Wink" title="Wink"><br>
<span style="font-weight: bold;">Дополнительные домены</span><br>
  Что-бы добавить дополнительные домены/динамические зоны, повторите шаги <span style="font-weight: bold;">1, 1.3, 1.4</span> и <span style="font-weight: bold;">1.5</span>, всем зонам укажите тот-же самый TSIG ключ. Добавьте записи в базу данных, как описано в параграфе <span style="font-weight: bold;">3.6</span>.<br>
<span style="font-weight: bold;">Новая версия скрипта (v. 0.3)</span><br>
  Внимание пользователи старой версии: структура базы данных изменилась, сравните с файлом <span style="font-style: italic;">MYSQL.sql</span> в архиве. <br>
<span style="font-weight: bold;">To do</span><br>
  Скрипт еще очень молодой и находится в стадии alpha, требуются переводчики, некоторые стринги прошите железно в скрипт и не берутся из языковых файлов, могут быть ошибки и недоделки. Кто хочет помочь, пишите.<br>
  За ущерб связаный с моей документацией и скриптом я не несу ни какой ответственности. Удачи.
			</div>



    </body>
</html>